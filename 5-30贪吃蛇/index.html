<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>æ£‹ç›˜</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<style type="text/css">
			.wrap {
				width: 400px;
				height: 400px;
				border: 1px solid orange;
				background-color: #eee;
				margin: auto;
			}
			
			.min_div {
				width: 20px;
				height: 20px;
				box-sizing: border-box;
				/*border: 1px solid violet;*/
				float: left;
				background-color: greenyellow;
				border-radius: 50%;
			}
			
			.red {
				background-color: green;
			}
			
			.orange {
				background-color: orange;
			}
			
			.head {
				background: url(img/head.png)  no-repeat center center;
				background-size: cover;
			}
		</style>
	</head>

	<body>
		<div class="wrap" id="wrap">

		</div>
	</body>
	<script type="text/javascript">
		$(function($) {
			var wrap = $("#wrap")[0];
			$("#wrap").css("width",Math.max(400,$("window").width()-10)) ;
			console.log($("#wrap").width());
			var arr_all = []; //åˆ›å»ºäºŒç»´æ•°ç»„,æ¯ä¸€ä¸ªå°æ•°ç»„ä»£è¡¨ä¸€è¡Œ
			var arr_snake = []; //ğŸèº«ä½“
			var snake_length = 3; //é»˜è®¤è›‡çš„é•¿åº¦ä¸º3
			var snake_head = snake_length - 1; //ğŸå¤´é•¿åº¦-1
			var timer = null;
			var x = 0;
			var direction = "right";
			var rows = 20;
			var colums = 20;
			var speed = 500;
			var now_direction = "right";
			create_map_arr(rows, colums);
			//åˆ›å»ºæ¸¸æˆé¢æ¿
			function create_map_arr(row, colum) {
				//è¡Œ
				for (var i = 0; i < row; ++i) {
					var arr_row = [];
					//åˆ—
					for (var j = 0; j < colum; ++j) {
						var min_div = document.createElement("div");
						min_div.className = "min_div";
						wrap.appendChild(min_div);
						arr_row.push(min_div);
					}
					arr_all.push(arr_row);
				}
			} //åˆ›å»ºæ¸¸æˆé¢æ¿ç»“æŸ
			//å±•ç¤ºğŸ
			show_snake();

			function show_snake() {
				for (var i = 0; i < snake_length; ++i) {
					arr_all[0][i].className = "min_div red";
					//arr_snake.push(arr_all[0][i]);
					arr_snake[i] = arr_all[0][i];
				}
			}
			game_begin();

			function game_over() {
				console.log("over");
				clearTimeout(timer);
			}
			create_food(); //åˆ›å»ºé£Ÿç‰©
			//é£Ÿç‰©åæ ‡
			var food_x;
			var food_y;

			function create_food() {
				food_x = parseInt(Math.random() * 19, 10);
				food_y = parseInt(Math.random() * 19, 10);
				if (is_on_snake()) {
					create_food();
				} else {
					arr_all[food_x][food_y].className = "min_div orange";
				}
			} //é£Ÿç‰©åˆ›å»ºç»“æŸ
			function is_on_snake() {
				//ä¸ç”¨éå†æ•°ç»„ å› ä¸ºå±äºğŸèº«ä½“çš„éƒ½æ˜¯çº¢è‰²
				if (arr_all[food_x][food_y] == "min_div red") {
					return true;
				} else {
					return false;
				}
			} //æ˜¯å¦ç”Ÿåœ¨äº†è›‡èº«ä¸Š
			//é”®ç›˜ç‚¹å‡»äº‹ä»¶
			document.onkeydown = function(event) {
				if (event.keyCode > 40 || event.keyCode < 37) {
					direction = now_direction;
				}
				switch (event.keyCode) {
					case 37:
						//å·¦
						direction = "left";
						if (now_direction == "right") {
							direction = "right";
							now_direction = "right";
						} else {
							now_direction = "left";
						}
						break;
					case 38:
						//ä¸Š
						direction = "top";
						if (now_direction == "bottom") {
							direction = "bottom";
							now_direction = "bottom";
						} else {
							now_direction = "top";
						}
						break;
					case 39:
						//å³
						direction = "right";
						if (now_direction == "left") {
							direction = "left";
							now_direction = "left";
						} else {
							now_direction = "right";
						}
						break;
					case 40:
						//ä¸‹
						direction = "bottom";
						if (now_direction == "top") {
							direction = "top";
							now_direction = "top";
						} else {
							now_direction = "bottom";
						}
						break;
					default:
						break;
				}
			}

			function checkMe(head) {
				//æ£€æµ‹æ˜¯å¦ç¢°åˆ°è‡ªå·±
				for (var i = 0; i < arr_snake.length; ++i) {
					if (arr_snake[i] == head) {
						return true;
					}
				}
				return false;
			}

			function tailHide() {
				//éšè—å°¾å·´
				arr_snake[0].className = "min_div";
			}

			function isAteFood() {
				//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©  ğŸå¤´çš„ä¸‹ä¸€ç›®æ ‡æ˜¯å¦å’Œé£Ÿç‰©åæ ‡ä¸€æ ·
				var next_pointX = x;
				var next_pointY = snake_head;
				switch (direction) {
					case "top":
						next_pointX--;
						break;
					case "bottom":
						next_pointX++;
						break;
					case "left":
						next_pointY--;
						break;
					case "right":
						next_pointY++;
						break;
					default:
						return false;
						break;
				}
				if (next_pointX == food_x && next_pointY == food_y) {
					return true;
				} else {
					return false;
				}
			}

			function move() {
				//ç§»åŠ¨èº«ä½“
				for (var i = 0; i < arr_snake.length; ++i) {
					arr_snake[i] = arr_snake[i + 1];
				}
			}

			function headShow() {
				//æ˜¾ç¤ºå¤´éƒ¨
				for (var i = 0; i < arr_snake.length; ++i) {
					if (arr_snake.length - 1 == i) {
						arr_snake[arr_snake.length - 1].className = "min_div red head";
					} else {
						arr_snake[i].className = "min_div red";
					}
				}
			}

			function game_begin() {
				//ğŸè¦å‘æŸä¸ªæ–¹å‘ç§»åŠ¨ï¼Œé»˜è®¤å³
				switch (direction) {
					case "left":
						//æœ‰æ²¡æœ‰ç¢°å£
						if (snake_head - 1 < 0) {
							game_over();
							break;
						}
						//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
						var head = arr_all[x][snake_head - 1];
						//						if (checkMe(head)) {
						//							game_over();
						//							break;
						//						}
						//å°¾å·´æ¶ˆå¤±
						tailHide();
						//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						if (isAteFood()) {
							//åƒåˆ°é£Ÿç‰©
							arr_snake.push(arr_all[food_x][food_y]);
							snake_length++;
							speed -= 20;
							create_food();
						} else {
							move();
							arr_snake[arr_snake.length - 1] = arr_all[x][snake_head - 1];
						}
						//è›‡å¤´æ˜¾ç¤º
						headShow();
						snake_head--;
						timer = setTimeout(game_begin, speed);
						break;
					case "right":
						//æœ‰æ²¡æœ‰ç¢°å£
						if (snake_head + 1 >= colums) {
							game_over();
							break;
						}
						//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
						var head = arr_all[x][snake_head + 1];
						if (checkMe(head)) {
							game_over();
							break;
						}
						//å°¾å·´æ¶ˆå¤±
						tailHide();
						//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						if (isAteFood()) {
							//åƒåˆ°é£Ÿç‰©
							arr_snake.push(arr_all[food_x][food_y]);
							snake_length++;
							speed -= 20;
							create_food();
						} else {
							move();
							arr_snake[arr_snake.length - 1] = arr_all[x][snake_head + 1];
						}
						//è›‡å¤´æ˜¾ç¤º
						headShow();
						snake_head++;
						timer = setTimeout(game_begin, speed);
						break;
					case "top":
						//æœ‰æ²¡æœ‰ç¢°å£
						if (x - 1 < 0) {
							game_over();
							break;
						}
						//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
						var head = arr_all[x - 1][snake_head];
						if (checkMe(head)) {
							game_over();
							break;
						}
						//å°¾å·´æ¶ˆå¤±
						tailHide();
						//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						if (isAteFood()) {
							//åƒåˆ°é£Ÿç‰©
							arr_snake.push(arr_all[food_x][food_y]);
							snake_length++;
							speed -= 20;
							create_food();
						} else {
							move();
							arr_snake[arr_snake.length - 1] = arr_all[x - 1][snake_head];
						}
						//è›‡å¤´æ˜¾ç¤º
						headShow();
						x--;
						timer = setTimeout(game_begin, speed);
						break;
					case "bottom":
						//æœ‰æ²¡æœ‰ç¢°å£
						if (x + 1 >= rows) {
							game_over();
							break;
						}
						//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
						var head = arr_all[x + 1][snake_head];
						if (checkMe(head)) {
							game_over();
							break;
						}
						//å°¾å·´æ¶ˆå¤±
						tailHide();
						//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						if (isAteFood()) {
							//åƒåˆ°é£Ÿç‰©
							arr_snake.push(arr_all[food_x][food_y]);
							snake_length++;
							speed -= 20;
							create_food();
						} else {
							move();
							arr_snake[arr_snake.length - 1] = arr_all[x + 1][snake_head];
						}
						//è›‡å¤´æ˜¾ç¤º
						headShow();
						x++;
						timer = setTimeout(game_begin, speed);
						break;
					default:
						break;
				}
			} //begin() END
		})
	</script>

</html>